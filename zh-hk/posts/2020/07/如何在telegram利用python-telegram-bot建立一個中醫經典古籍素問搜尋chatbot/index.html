<!DOCTYPE html>
<html lang="zh-hk">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:工程部]">
<meta name="description" content="利用python-telegram-bot建立chatbot教學" />
<meta name="keywords" content="coding, chinese-medicine, blogging, telegram, chatbot, python-telegram-bot" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://herboratory.github.io/engineering-department/zh-hk/posts/2020/07/%E5%A6%82%E4%BD%95%E5%9C%A8telegram%E5%88%A9%E7%94%A8python-telegram-bot%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8B%E4%B8%AD%E9%86%AB%E7%B6%93%E5%85%B8%E5%8F%A4%E7%B1%8D%E7%B4%A0%E5%95%8F%E6%90%9C%E5%B0%8Bchatbot/" />


    <title>
        
            如何在Telegram利用python-telegram-bot建立一個中醫經典古籍《素問》搜尋chatbot :: 工程部  — 中醫，天人之學。
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://herboratory.github.io/engineering-department/main.031a8efc33f94f55a4071bf4e91596478a5809fc8c148fab113801189cfd2152.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://herboratory.github.io/engineering-department/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://herboratory.github.io/engineering-department/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://herboratory.github.io/engineering-department/favicon-16x16.png">
    <link rel="manifest" href="https://herboratory.github.io/engineering-department/site.webmanifest">
    <link rel="mask-icon" href="https://herboratory.github.io/engineering-department/safari-pinned-tab.svg" color="#1b1c1d">
    <link rel="shortcut icon" href="https://herboratory.github.io/engineering-department/favicon.ico">
    <meta name="msapplication-TileColor" content="#1b1c1d">
    <meta name="theme-color" content="#1b1c1d">



<meta itemprop="name" content="如何在Telegram利用python-telegram-bot建立一個中醫經典古籍《素問》搜尋chatbot">
<meta itemprop="description" content="利用python-telegram-bot建立chatbot教學"><meta itemprop="datePublished" content="2020-07-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-07-25T00:00:00+00:00" />
<meta itemprop="wordCount" content="1297"><meta itemprop="image" content="https://herboratory.github.io/engineering-department"/>
<meta itemprop="keywords" content="telegram,chatbot,python-telegram-bot," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://herboratory.github.io/engineering-department"/>

<meta name="twitter:title" content="如何在Telegram利用python-telegram-bot建立一個中醫經典古籍《素問》搜尋chatbot"/>
<meta name="twitter:description" content="利用python-telegram-bot建立chatbot教學"/>




    <meta property="og:title" content="如何在Telegram利用python-telegram-bot建立一個中醫經典古籍《素問》搜尋chatbot" />
<meta property="og:description" content="利用python-telegram-bot建立chatbot教學" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://herboratory.github.io/engineering-department/zh-hk/posts/2020/07/%E5%A6%82%E4%BD%95%E5%9C%A8telegram%E5%88%A9%E7%94%A8python-telegram-bot%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8B%E4%B8%AD%E9%86%AB%E7%B6%93%E5%85%B8%E5%8F%A4%E7%B1%8D%E7%B4%A0%E5%95%8F%E6%90%9C%E5%B0%8Bchatbot/" /><meta property="og:image" content="https://herboratory.github.io/engineering-department"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-25T00:00:00+00:00" /><meta property="og:site_name" content="工程部" />





    <meta property="article:section" content="python" />

    <meta property="article:section" content="tutorial" />



    <meta property="article:published_time" content="2020-07-25 00:00:00 &#43;0000 UTC" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://herboratory.github.io/engineering-department/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">$ cd 扶疏堂研究所｜Herboratory/home/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#5B5B5B;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://herboratory.github.io/engineering-department/zh-hk/posts/">文章</a></li><li><a href="https://herboratory.github.io/engineering-department/zh-hk/about/">關於</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
            
                
                    <a class="button is-small is-danger is-rounded" href="https://herboratory.github.io/engineering-department/">English</a>
                
            
            <span class="theme-toggle">
                <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>
            </span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        7分鐘

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://herboratory.github.io/engineering-department/zh-hk/posts/2020/07/%E5%A6%82%E4%BD%95%E5%9C%A8telegram%E5%88%A9%E7%94%A8python-telegram-bot%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8B%E4%B8%AD%E9%86%AB%E7%B6%93%E5%85%B8%E5%8F%A4%E7%B1%8D%E7%B4%A0%E5%95%8F%E6%90%9C%E5%B0%8Bchatbot/">如何在Telegram利用python-telegram-bot建立一個中醫經典古籍《素問》搜尋chatbot</a>
      </h1>

      
        <div class="post-excerpt">利用python-telegram-bot建立chatbot教學</div>
      

      

      

      <div class="post-content">
        <h3 id="前言">【前言】</h3>
<p>Telegram最近在香港和台灣開始比較為人所知而使用。一方面是相對比較安全，而且有group chat、channel等功能；另一方面是，比起LINE，Telgram的chatbot的限制沒這麼多，而且是<strong>免費！免費！免費！</strong>（這是重點之重🤫）對於開發budget非常不多的人來說，Telegram是一個不錯的選項。</p>
<p>用Python寫Telegram chatbot最大的好處是有現成的package可用，例如<a href="https://python-telegram-bot.org">python-telegram-bot</a>和<a href="https://github.com/eternnoir/pyTelegramBotAPI#telebot">pyTelegram</a>，當然也能透過Flask、requests自行搗鼓出來。以套件來說，tutorial方面，不管是中、英文，套件以python-telegram-bot比較多，而且有專屬自己的、在Telegram討論group發問（不過感覺有時候不太friendly就是，而且問的人很多，有時候一不小心有人回答了對話也飄走了）；pyTelegram則在YouTube教學比較多。經過評估，最後決定用python-telegram-bot的套件。</p>
<p>寫完這個chatbot的tutorial，暫時不會再隨意寫程式，因為想要回歸中醫本行去開發別的東西，而且想要去乖乖上課improve CS知識方便之後寫web app。寫這篇收山之作，是因為之前寫算盤子君🤖️（@glochidion_bot，大概暫時是唯一一個尋找和查詢有招收香港學生的台灣的大學系所和老師專長資料的Telegram chatbot）困難重重，一是不少python-telegram-bot的tutorial已經過期，二是碰壁試過撞牆多次後才求救叫天不應叫地不聞，有人聞了卻一句戳說是伸手黨，之前撞牆本來就煩躁，加上一個「伸手黨」把自己曾經努力過被抹殺，煩躁就如星火燎原那般燃燒起來，更TM的不爽了。既然如此，就決定再寫一個Telegram chatbot，專門給新手入門和伸手黨使用🤓，讓撞牆撞到了無生趣、非專業背景但想要入門的同好有個好開端。這個《素問》搜尋🔍chatbot是節取自徐長卿君🤖️（@cynanchum_bot，大概算是首個中醫經典古籍搜尋chatbot，除了《素問》，還有《傷寒論》、《神農本草經》和《難經》）的《素問》搜尋部分。沒有中醫背景的人沒關係，就當作是設計一個搜尋機器人去看就好，因為框架都差不多。</p>
<p>至於看完這個tutorial會學到啥？</p>
<ol>
<li>如何從零開始設計chatbot - 從寫之前要注意的到寫程式到放到Google Cloud Platform的Compute Engine上跑</li>
<li>如何用python-telegram-bot寫chatbot - 除了一般對話對應，還有如何加入inline keyboard（inline keyboard讓我撞牆很久簡直是崩潰邊緣，這部分簡直是血書&hellip;因為python-telegram-bot的demo寫的很莫名其妙根本不知道想要表達啥，其他tutorial要不過期要不就不work）</li>
</ol>
<h3 id="開始寫之前---注意事項">【開始寫之前 - 注意事項】</h3>
<p>在開始實際寫之前，先說下一個Telegram chatbot設計需要注意的事項。</p>
<p>首先，Telegram的chatbot default是不能主動跟user有任何動作，即使曾經使用過也不行🙅‍♂️。</p>
<p>對於首次使用某個chatbot的user，第一個command給chatbot就是/start，這是每個bot設計的時候非常強烈建議要有（我沒試過設計沒有/start的，所以也不知道後果會怎樣，推測可能chatbot會不理你吧）。之後可以直接用其他command去跟chatbot溝通，也可以繼續用/start。</p>
<p>其次，根據個人需求，可以設計/help幫助指引user如何使用chatbot。這個設計對於使用有多功能的chatbot來說很重要。就如第一次去有目的的逛大的shopping mall，為了省事方便，都會找顧客服務中心問，同樣道理。</p>
<p>第三，非常強烈建議設計chatbot時要規範使用範圍。這是啥意思呢？意思是當用戶輸入一些用途以外的字眼，chatbot不會愣在哪不回應或甚至直接down機（user很會把機器玩壞滴～），而是有feedback給user，例如說“挖垮薄吼請重新輸入”之類的。</p>
<p>第四，在程式部分要有error log，這是方便開發時出現error會有指引告訴你哪裡出問題，不管是自己debug還是找別人求救時有個方向。</p>
<p>第五，建議開始動手寫chatbot之前先想好、設計好chatbot的流程。例如會想要chatbot做啥、達到「做啥」這個目的需要有什麼步驟和需要啥部件；仔細一點的話，可以順便想對話內容，例如想chatbot的語氣、回應方式之類的。</p>
<p>接下來會根據接下來要寫的《素問》搜尋chatbot，寫一個chatbot設計流程。</p>
<h3 id="開始寫之前---寫設計流程">【開始寫之前 - 寫設計流程】</h3>
<p>在開始寫chatbot之前先寫設計流程，除了可以幫助釐清自己的想法，也可以更清楚看到整體架構，從而看到整體架構有否缺陷。同時會更清楚自己寫的時候在寫什麼，不會出現東寫一塊、西加一塊。以下就開始寫個《素問》搜尋🔍chatbot的設計流程吧！</p>
<p><strong>[設計流程]</strong></p>
<p>這個chatbot可以幹嘛：讓user input keyword搜尋《素問》內容句子。</p>
<p>開發環境：Python 3.7</p>
<p>使用套件：python-telegram-bot</p>
<p>特別點：python-telegram-bot中，一個command和非command功能會以一個def對應一個dispatcher的方式才能運作</p>
<p>檔案架構： # 建議使用虛擬環境venv，獨立開個folder儲存運行。以下也會預設在獨立folder的venv進行。若不知道如何設置虛擬環境，可參考<a href="https://docs.python.org/3/library/venv.html">這裡</a>。</p>
<ul>
<li>主程式：cynanchum_bot.py</li>
<li>存放搜尋用資料的資料夾：data #資料以JSON形式儲存</li>
</ul>
<p>程式架構：</p>
<ol>
<li>需要import的package</li>
<li>允許logging用以紀錄錯誤時哪裏出問題</li>
<li>Telegram chatbot的基礎設定，如token、bot、updater （這部分會建議大家用package之前看看demo）</li>
<li>指令/start：用來給user首次啟動chatbot</li>
<li>指令/about：解釋這個bot的背景，順便給herboratory打打廣告</li>
<li>指令/help：指引用戶如何使用chatbot</li>
<li>指令/suwen：搜尋《素問》的程式部分</li>
<li>getClickButtonData：在/about用到inline keyboard，而inline keyboard在user按下按鈕後，chatbot會根據inline keyboard的指令給予相對應的feedback。回應的setting就在這裡</li>
<li>reply_handler：只要輸入非指令的字眼都會跑這部分回應user</li>
<li>error_handler：出現error會跑這部分回應user</li>
<li>error：用來顯示error log。error_handler是對user回應；error是給開發者知道出啥問題</li>
<li>main：所有def的dispatcher會放到這裡。python-telegram-bot的chatbot啟動待機的部分也會放到這裡。</li>
<li>運行main</li>
</ol>
<p>【以上】</p>
<p>有了設計流程，就知道接下來的工作內容 - 就是正式開始寫chatbot了。</p>
<h3 id="終於開始寫---起手式先去找botfather給自己的chatbot蛾子挖個蘿蔔坑">【終於開始寫 - 起手式：先去找BotFather給自己的chatbot蛾子挖個蘿蔔坑】</h3>
<p>既然要寫Telegram chatbot，當然得讓Telegram知道這個bot的存在。跟LINE不一樣的是，Telegram有個BotFather專門管理集中閣下的chatbot。當有了Telegram帳戶後，就能@BotFather去給chatbot挖蘿蔔坑。詳細步驟有前人已經寫得很好，就不在這裡覆述。大家可以根據<a href="https://medium.com/@zaoldyeck/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%80%8E%E9%BA%BC%E6%89%93%E9%80%A0-telegram-bot-a7b539c3402a">這裡</a>的步驟去註冊個坑，獲得token。token會在寫程式時會用到。</p>
<p>BotFather除了註冊chatbot，還能幫你的chatbot做設定，例如之後想要更改顯示名稱、加入/修改chatbot的關於、描述、圖片等。要設定很簡單，在@BotFather輸入/start就好。注意的是，例如徐長卿君🤖️的「@cynanchum_bot」，決定了是不能更改的，但是「徐長卿君🤖️」是可以在BotFather更改。</p>
<h3 id="終於開始寫---程式部分">【終於開始寫 - 程式部分】</h3>
<p>程式部分根據設計流程部分，把相關的東西寫好即可。Telegram chatbot的command，寫完是可以獨立測試。建議每寫好一個command或功能部分先跑看看測試，以免之後一次過測試出現一大堆error還不知道該如何入手debug。</p>
<h4 id="寫ing---import的啥東">【寫ing - import的啥東】</h4>
<p>程式架構第一項就是import package。學過寫過Python都知道要import package。</p>
<p>這裡我們需要import用到的python-telegram-bot package</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> json    <span style="color:#75715e">#用來讀取搜尋資料檔</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> os.path
<span style="color:#f92672">import</span> logging    <span style="color:#75715e">#顯示log</span>
<span style="color:#f92672">import</span> telegram    <span style="color:#75715e">#運行telegram用</span>
<span style="color:#f92672">from</span> telegram.ext <span style="color:#f92672">import</span> Updater, CommandHandler, CallbackQueryHandler, MessageHandler, Filters, CallbackContext, ConversationHandler 
</code></pre></div><p>Updater是每個chatbot都會用到。如名字，對話會需要update，就是靠這個
CommandHandler就是用來處理輸入command用的部分
CallbackQueryHandler：在about用到inline keyboard時的按鈕指令部分就靠這個處理
MessageHandler：chatbot處理對話訊息的部分
Filters：在reply_handler用到，設定若非設定command會回覆用戶不知道說啥的訊息時的部分，配合MessageHandler用
CallbackContext：這個用來pass callback。這裡主要針對在error和error_handler時使用。但根據撞牆得知，這個版本v12會用到CallbackContext，但聽聞v13會改。所以就照樣先跟著用就好。
ConversationHandler：如其名，就是處理對話的部分</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> telegram <span style="color:#f92672">import</span> InlineKeyboardMarkup, InlineKeyboardButton
<span style="color:#75715e">#InlineKeyboardMarkup, InlineKeyboardButton：建立inline keyboard必須用到的部分</span>
</code></pre></div><h4 id="寫ing---logging">【寫ing - logging】</h4>
<p>import完會用到的東西，就把顯示log的部分加進來。這部分基本上就是根據python-telegram-bot的用法照樣copy &amp; paste過來就好。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">logging<span style="color:#f92672">.</span>basicConfig(format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(name)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>,
                    level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)

logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</code></pre></div><p>這部分基本上就是根據python-telegram-bot的default用法照樣copy &amp; paste過來就好。基本上<a href="https://github.com/python-telegram-bot/python-telegram-bot/tree/master/examples">那面</a>每個demo都是這樣的用法。</p>
<h4 id="寫ing---telegram-chatbot的基礎設定">【寫ing - Telegram chatbot的基礎設定】</h4>
<p>Telegram chatbot的基礎設定，包括chatbot的token - 也就是去找@BotFather挖蘿蔔坑獲得的一串。不記得的話就去@BotFather看看。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 在基礎設定，要創造Updater，將token pass給Updater。</span>
<span style="color:#75715e"># 注意的是，在v12中要加入“use_context = True”（之後版本不需要），用於有新訊息是回應。</span>
<span style="color:#75715e"># 此外TOKEN、bot和updater要放在def外面。若只放在main()會出現錯誤</span>
TOKEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;paste-your-token-here&#34;</span>
bot <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>Bot(token <span style="color:#f92672">=</span> TOKEN)
updater <span style="color:#f92672">=</span> Updater(TOKEN, use_context <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</code></pre></div><h4 id="寫ing---指令start">【寫ing - 指令/start】</h4>
<p>在python-telegram-bot，指令都會一個def對應一個後面會在main寫的dispatcher。這裡的/start command，預設user輸入/start後會回覆跟user打招呼，還有提供基本的「救命」指令，例如/help、/about。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_handler</span>(update, context: CallbackContext):

    <span style="color:#75715e"># chatbot在接受用戶輸入/start後的output內容</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING) <span style="color:#75715e"># 會顯示chatbot正在輸入中，增加對話真實感</span>
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>) <span style="color:#75715e"># 在顯示輸入中後停頓1秒，然後顯示下一句code的文字</span>
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;Hello! 你好👋，</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">！我是徐長卿君🤖&#34;</span><span style="color:#f92672">.</span>format(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>from_user<span style="color:#f92672">.</span>first_name)) <span style="color:#75715e"># 給user的output</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;徐長卿君🤖️是個chatbot，能根據關鍵字搜尋《黃帝內經素問》的內容</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">❓關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭，請輸入 /about&#34;</span>) <span style="color:#75715e"># 給user的output。output可以分開多次使用update.message.reply_text()。</span>
</code></pre></div><p>update.message.reply_text()是chatbot回復user的line，若想要分段顯示，可以重複使用。</p>
<p>在程式輸入/help、/about等command時，在Telegram的dialogue是會顯示成可以按的command。若相關command還沒建立或沒建立好而去按，可能會造成error。若只是測試顯示而不去按是沒問題的。</p>
<h4 id="寫ing---main">【寫ing - main】</h4>
<p>預設寫的順序main會在很後面，但為啥現在就要寫呢？因為是要測試用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;啟動bot&#34;&#34;&#34;</span>
    <span style="color:#75715e"># 設定使用dispatcher，用來以後設定command和回覆用</span>
    dp <span style="color:#f92672">=</span> updater<span style="color:#f92672">.</span>dispatcher
    dp<span style="color:#f92672">.</span>add_handler(CommandHandler(<span style="color:#e6db74">&#34;start&#34;</span>, start_handler)) <span style="color:#75715e"># 啟動chatbot</span>
    <span style="color:#75715e">#dp.add_handler(CommandHandler(&#34;help&#34;, help_handler)) # 顯示幫助的command</span>
    <span style="color:#75715e">#dp.add_handler(CommandHandler(&#34;about&#34;, about_handler)) # 顯示關於徐長卿君🤖️的command</span>
    <span style="color:#75715e">#dp.add_handler(CommandHandler(&#34;suwen&#34;, suwen_handler)) # 《素問》中文版搜尋功能</span>
    <span style="color:#75715e">#dp.add_handler(CallbackQueryHandler(getClickButtonData)) # 設定關於徐長卿君🤖️的按鈕連結</span>
    <span style="color:#75715e">#dp.add_handler(MessageHandler(Filters.text, reply_handler)) # 設定若非設定command會回覆用戶不知道說啥的訊息</span>
    <span style="color:#75715e">#dp.add_error_handler(error_handler) # 出現任何非以上能預設的error時會回覆用戶的訊息內容</span>

    <span style="color:#75715e"># 專門紀錄所有errors的handler，對應def error()</span>
    <span style="color:#75715e">#dp.add_error_handler(error)</span>

    <span style="color:#75715e"># 啟動Bot。bot程式與Telegram連結有兩種方式：polling和webhook。</span>
    <span style="color:#75715e"># 兩者的差異可以參考這篇reddit的解釋：https://www.reddit.com/r/TelegramBots/comments/525s40/q_polling_vs_webhook/。</span>
    <span style="color:#75715e"># 在python-telegram-bot裡面本身有built-in的webhook方法，但是在GCE中暫時還沒摸索到如何設定webhook，因此polling是最便捷的方法。</span>
    updater<span style="color:#f92672">.</span>start_polling()

    <span style="color:#75715e"># 就是讓程式一直跑。</span>
    <span style="color:#75715e"># 按照package的說法“start_polling() is non-blocking and will stop the bot gracefully.”。</span>
    <span style="color:#75715e"># 若要停止按Ctrl-C 就好</span>
    updater<span style="color:#f92672">.</span>idle()

<span style="color:#75715e">#運行main()，就會啟動bot。</span>
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    main()
</code></pre></div><p>由於根據大綱已經知道要寫那些command和部件，因此可以偷懶預先設定各個dispatcher，把暫時不用的先#起來。set dispatcher就是update.dispatcher.add_handler()。而為了省事，update.dispatcher這裡就以dp代替，因此上面的code就變成dp.add_handler()。</p>
<p>大家可能留意到，在add_handler()裡面，若是對應command的話，CommandHandler(&ldquo;command&rdquo;, function_name)的格式；若是等下會用到的inline keyboard發出的指令，就會用CallbackQueryHandler(function_name)；若是處理command以外的用字回應，會使用MessageHandler(Filters.text, function_name)；若是處理error的部分就用dp.add_error_handler(function_name)（例如我這裡的function命名是error，就是dp.add_error_handler(error)）。這些dispatcher都是python-telegram-bot常用的。基本上根據格式用即可。</p>
<p>啟動運行chatbot，就是updater.start_polling()。運行方法在code上面有解釋，這裡不做覆述。而updater.idle()這句是讓程式一直跑。</p>
<p>寫完這部分就可以測試跑。</p>
<p>就在terminal的虛擬環境下輸入以下command：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">python cynanchum_bot<span style="color:#f92672">.</span>py
</code></pre></div><p>然後程式就會開始跑。注意看看是否正常運行、有沒有error需要debug，出現error需要debug就先debug。然後就可以去Telegram跟自己的chatbot打招呼🙋‍♂️。第一次用chatbot要先加chatbot。當初徐長卿君🤖️的ID是cynanchum_bot，所以就在搜尋輸入「cynanchum_bot」，一切正常就會在搜尋結果顯示chatbot。加入chatbot後，就可以第一次開齋了。</p>
<p>輸入/start後，就會出現以下結果：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-16.13.58-1024x429.png" alt=""></p>
<p>就這樣，第一個command成功可用了！🤤🤪❤️</p>
<p>由於之前偷懶的關係，把main的dispatcher都預先寫好暫時#，所以之後每寫完一個function部分，就去main把相對應的dispatcher的#去掉，就可以進行測試。</p>
<h4 id="寫ing---about">【寫ing - /about】</h4>
<p>/about的部分，設計對話跟/start類似，code也是沿用/start的update.message.reply_text()。這部分的重點在於如何設置inline keyboard。Inline keyboard的好處是限制用戶只能選擇提供的按鈕，而且用途廣泛，除了可以用在Telegram裡面，也能用在提供用戶連結。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">about_handler</span>(update, context: CallbackContext):

    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;感謝使用徐長卿君🤖️。徐長卿君🤖️是一個教學用的中醫搜尋chatbot，除了作為中醫古籍搜尋，另外最大目的是讓想要利用python-telegram-bot的新手有個最新的tutorial可供參考。主人曾經跟我說，在做上一個 - 也是第一個Telegram的chatbot算盤子君🤖️（一個台灣大學資訊的chatbot，有興趣可以去@glochidion_bot找算盤子君🤖️）經歷不太愉快。一方面是documentation和tutorial對於新手蠻unfriendly，而且不少已經開始有點過期，同時也沒有太多關於deploy的文章；另一方面有一次因為想要整理output的code一直不成功去求救卻被說是伸手黨，感覺自己努力過卻被當作白痴，太把自己的知識當作理所當然。氣不過，決定根據自己的專業建立一個中醫古籍搜尋器的Telegram chatbot，也藉此寫一篇tutorial，從建立到測試、測試到deploy，讓新手有個可以參考整個過程、實際應用的demo，同時也讓中醫人有多一個工具。&#34;</span>) 
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;徐長卿君🤖️儲存的資料很多，所有資料都是主人親手校對整理，出錯在所難免，因此若想要報錯，又或者有任何疑問、建議，或者想透過徐長卿君🤖️宣傳、洽談合作，可以去扶疏堂研究所的Facebook page私訊聯繫，或者歡迎瀏覽扶疏堂研究所的網站看看其他項目和服務。&#34;</span>)
    
    <span style="color:#75715e"># Inline keyboard的部分</span>
    reply_markup <span style="color:#f92672">=</span> InlineKeyboardMarkup([[
        InlineKeyboardButton(<span style="color:#e6db74">&#34;Facebook&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.facebook.com/herboratory/ &#34;</span>),
        InlineKeyboardButton(<span style="color:#e6db74">&#34;Website&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://herboratory.ai/&#34;</span>)],
        [InlineKeyboardButton(<span style="color:#e6db74">&#34;關於徐長卿君🤖️ About Cynanchum kun🤖️&#34;</span>, callback_data<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;about_me&#34;</span>)]])

    bot<span style="color:#f92672">.</span>send_message(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>id, <span style="color:#e6db74">&#34;想了解什麼？若要報錯或反饋，歡迎透過Facebook或網站與扶疏堂研究所聯繫。&#34;</span>, reply_to_message_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>message_id,
                     reply_markup <span style="color:#f92672">=</span> reply_markup)
</code></pre></div><p>Inline keyboard的格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">reply_markup_1 <span style="color:#f92672">=</span> InlineKeyboardMarkup([[
        InlineKeyboardButton(<span style="color:#e6db74">&#34;在Telegram顯示的項目名稱1號&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;按鈕按下去想要連結到的網址&#34;</span>),
        InlineKeyboardButton(<span style="color:#e6db74">&#34;在Telegram顯示的項目名稱2號&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;按鈕按下去想要連結到的網址&#34;</span>)],
        [InlineKeyboardButton(<span style="color:#e6db74">&#34;在Telegram顯示的項目名稱3號&#34;</span>, callback_data<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;設定callback_data的反應字&#34;</span>)]])

    bot<span style="color:#f92672">.</span>send_message(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>id, <span style="color:#e6db74">&#34;在inline keyboard彈出來時chatbot在dialogue顯示的回應訊息&#34;</span>, reply_to_message_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>message_id,
                     reply_markup <span style="color:#f92672">=</span> reply_markup_1)
</code></pre></div><p>首先，reply_markup_1是一個自定義命名，可以不叫reply_markup_1，叫reply_markup也可，但記得改完名稱，在下面的reply_markup_1的位置也要寫上對應的名稱，不然inline keyboard無法正常運行。</p>
<p>接下來在InlineKeyboardMarkup裡面有很多[ ]。在這裡，即使是一個按鈕，也需要用 [ ]框住，就是這樣：[InlineKeyboardButton(&ldquo;在Telegram顯示的項目名稱1號&rdquo;, url = &ldquo;按鈕按下去想要連結到的網址&rdquo;)]。若有多個，想要另開新一行顯示，就在[ ]後面加上「,」，然後再開一個[ ]框。以上的code在Telegram裡面會呈現倒品字形。</p>
<p>內容的話，若要顯示連結🔗，則用InlineKeyboardButton(&ldquo;在Telegram顯示的項目名稱1號&rdquo;, url = &ldquo;按鈕按下去想要連結到的網址&rdquo;)。若要之後是要在Telegram內讓chatbot根據選項回應，則用InlineKeyboardButton(&ldquo;在Telegram顯示的項目名稱3號&rdquo;, callback_data=&ldquo;設定callback_data的反應字&rdquo;)。兩者差異就是一個是用url，一個是callback_data。callback_data所輸入的字眼會在之後的getClickButtonData的function中，若detect得到callback_data裡面的字眼，就會根據設定顯示。而在這個chatbot，callback_data設定是about_me。</p>
<h4 id="寫ing---getclickbuttondata">【寫ing - getClickButtonData】</h4>
<p>寫完/about的部分，不能立刻測試，因為inline keyboard還沒設定完成。剛剛說，/about的inline keyboard有個部分會在Telegram的dialogue顯示回應，這裡就是設定回應的部分。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getClickButtonData</span>(update, context):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    透過上方的about function取得了callback_data=&#34;about_me&#34;，針對取得的參數值去判斷說要回覆給使用者什麼訊息
</span><span style="color:#e6db74">    取得到對應的callback_data後，去判斷說是否有符合，有符合就執行 update.callback_query.edit_message_text
</span><span style="color:#e6db74">    傳送你想傳送的訊息給使用者
</span><span style="color:#e6db74">    由於這裡不再是單純發訊息，而是再用callback_query的方法，發訊息時，chat_id = update.message.chat_id是不能用，要改成chat_id = update.callback_query.message.chat_id
</span><span style="color:#e6db74">    而偽裝輸入正在輸入中也要改成chat_id = update.callback_query.message.chat_id
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">if</span> update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>data <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;about_me&#34;</span>:
        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>edit_message_text(<span style="color:#e6db74">&#34;感謝使用徐長卿君🤖️。徐長卿君🤖️是一個教學用的中醫搜尋chatbot，除了作為中醫古籍搜尋，另外最大目的是讓想要利用python-telegram-bot的新手有個最新的tutorial可供參考。主人曾經跟我說，在做上一個 - 也是第一個Telegram的chatbot算盤子君🤖️（一個台灣大學資訊的chatbot，有興趣可以去@glochidion_bot找算盤子君🤖️）經歷不太愉快。一方面是documentation和tutorial對於新手蠻unfriendly，而且不少已經開始有點過期，同時也沒有太多關於deploy的文章；另一方面有一次因為想要整理output的code一直不成功去求救卻被說是伸手黨，感覺自己努力過卻被當作白痴，太把自己的知識當作理所當然。氣不過，決定根據自己的專業建立一個中醫古籍搜尋器的Telegram chatbot，也藉此寫一篇tutorial，從建立到測試、測試到deploy，讓新手有個可以參考整個過程、實際應用的demo，同時也讓中醫人有多一個工具。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">徐長卿君🤖️儲存的資料很多，所有資料都是主人親手校對整理，出錯在所難免，因此若想要報錯，又或者有任何疑問、建議，或者想透過徐長卿君🤖️宣傳、洽談合作，可以去扶疏堂研究所的Facebook page私訊聯繫，或者歡迎瀏覽扶疏堂研究所的網站看看其他項目和服務。&#34;</span>)
</code></pre></div><p>如前述，之前callback_data是設成about_me，因此這個function最大的目的就是，若detect得到回傳“about_me”，也就是「if update.callback_query.data == &ldquo;about_me&rdquo;:」這句，就跑if下面的的東西。</p>
<p>注意的是，在這裡若要顯示訊息，chatbot的回應要改成update.callback_query.edit_message_text，偽裝輸入正在輸入中也要改成update.callback_query.message.chat_id，不然會出現error。這是由於這裡是使用callback_query方法，並非以message的方法傳送訊息。這裡之前讓我撞牆到懷疑人生，就是不知道要把message改成callback_query，因此一直出現error。</p>
<p>這部分設定好，記得在main()裡對應的about_handler和getClickButtonData的dispatcher把#去掉，就可以測試。</p>
<p>去虛擬環境再跑python 檔案，然後在Telegram輸入/about，會顯示這個樣子：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-16.57.12-971x1024.png" alt=""></p>
<p>按下「關於徐長卿君🤖️ About Cynanchum kun🤖️」，若getClickButtonData設定正確，會顯示一下畫面：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-16.59.16-1024x722.png" alt=""></p>
<p>如是者，/about的部分就做好了！😆😆😆</p>
<h4 id="寫ing---help">【寫ing - /help】</h4>
<p>寫/help的部分，程式跟/start非常類似。這裡注意的點就是設計對話方面，給user的指示要清晰簡單，不要拐彎抹角。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">help_handler</span>(update, context: CallbackContext):

    <span style="color:#75715e"># chatbot在接受用戶輸入/start後的output內容</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;《🔍如何使用》</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">搜尋《黃帝內經素問》（中文版）🔸</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">輸入：「/suwen （搜尋關鍵字）」</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">例如：/suwen 伏梁、/suwen 肺脈</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭，請輸入 /about&#34;</span>) 
</code></pre></div><p>同樣的，寫完去main()把help對應的help_handler的dispatcher的#去掉，再把程式跑起來後去Telegram測試，成功的話就會出現以下畫面：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-17.06.29-1024x415.png" alt=""></p>
<p>就這樣，/help command的部分就大功告成！🤪🤪🤪</p>
<h4 id="寫ing---素問搜尋指令suwen">【寫ing - 《素問》搜尋指令/suwen】</h4>
<p>寫這部分最大的挑戰是要把user輸入的關鍵字與command /suwen分開來。這部分寫法是源自<a href="https://markteaching.com/telegram-bot-records/">這裡</a>。基本上搜尋command格式也是類似，就是/suwen 搜尋關鍵字。所以首先要先判斷輸入的搜尋command是否有搜尋關鍵字。而「/suwen 」（連空格）共7個字元，因此可以用if去判斷，若輸入字元小於等於7，也就是代表只有「/suwen 」時，就會告訴user輸入錯誤。當然有人會問，若字元小於7，已經不是/suwen的command，因此在接下來後面還會做雙重保險，若是輸入非command字眼，就會有回覆告訴user。</p>
<p>當判斷輸入的內容大於7個字元，就代表後面是有東西，然後就擷取keyword的部分，並確定是string，就開始搜尋並顯示結果；若不是string，就會回傳輸入方式有錯誤。這篇的重點主要在如何建立Telegram chatbot，因此搜尋的寫法不在這裡講解。</p>
<p>有個地方要注意，在Telegram，一個訊息是有字數限制，不能超過4096個字。所以在下面程式，結果顯示超過10項會分開message顯示。當然不代表顯示10筆就沒事，而是這是我的資料經過測試後比較理想的顯示方式。因此若打算顯示長篇大論的話就要注意字數限制。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suwen_handler</span>(update, context: CallbackContext):
    <span style="color:#66d9ef">if</span> len(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">7</span>:  <span style="color:#75715e"># 如果單純輸入 /suwen 會跟你說叫你該如何輸入，以及因為/suwen 的字元數量一定會小於7</span>
        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;你輸入方式有錯誤。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">請輸入：/suwen 搜尋關鍵字 </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74"> 例如: /suwen 伏梁&#34;</span>)
    <span style="color:#66d9ef">else</span>:
        keyword <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text[<span style="color:#ae81ff">7</span>:] <span style="color:#75715e"># 取得到 /suwen 後面的參數值</span>
        <span style="color:#66d9ef">if</span> type(keyword) <span style="color:#f92672">==</span> str:
            <span style="color:#75715e"># 搜尋keywords資料</span>
            <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;data/suwen.json&#34;</span>) <span style="color:#66d9ef">as</span> json_file: <span style="color:#75715e"># 打開suwen.json</span>
                data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(json_file)

            search_result <span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">for</span> items <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;items&#34;</span>]:
                article <span style="color:#f92672">=</span> items[<span style="color:#e6db74">&#39;article&#39;</span>]
                <span style="color:#66d9ef">for</span> quotes <span style="color:#f92672">in</span> items[<span style="color:#e6db74">&#34;content&#34;</span>]:
                    <span style="color:#66d9ef">if</span> keyword <span style="color:#f92672">in</span> quotes:
                        search_result<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#34;原句&#34;</span>: quotes, <span style="color:#e6db74">&#34;出處&#34;</span>: article})

            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> search_result:
                bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
                update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;查無結果。🤔😐😔&#34;</span>)

            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;搜尋結果：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">for</span> i, quote_data <span style="color:#f92672">in</span> enumerate(search_result):
                    <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> quote_data:
                        text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">：</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, quote_data[key])
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">------&#34;</span>
                    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">or</span> i <span style="color:#f92672">==</span> len(search_result) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
                        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
                        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
                        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(text)
                        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;搜尋結果（續）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>

        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># 輸入錯誤格式或有誤時，請重新輸入</span>
            update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;你輸入方式有錯誤。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">請輸入：/suwen 搜尋關鍵字 </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74"> 例如: /suwen 伏梁&#34;</span>)
</code></pre></div><p>若搜尋部分沒問題，輸入/suwen 伏梁會出現以下結果：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-17.24.53-1024x985.png" alt=""></p>
<p>若能正確顯示搜尋結果，就代表/suwen command的部分大功告成！🙃</p>
<h4 id="寫ing---防止chatbot被玩壞的reply_handler">【寫ing - 防止chatbot被玩壞的reply_handler】</h4>
<p>chatbot寫到這裡，主要功能部分就算是完成了。接下來要採取預防措施防止chatbot蛾子被user玩壞。</p>
<p>預防措施可以分成兩個部分，一個是接下來要做的reply_handler，一個是這個之後的error_handler和error的部分。reply_handler基本上最大預防被user玩壞的關卡 - 因為預設只要user不是輸入正確的command，不管是否故意，反正就直接會顯示類似「挖垮薄」的訊息提醒user。因此邏輯很簡單，只要不是以上的command，就跑這一部分。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reply_handler</span>(update, context: CallbackContext):
    <span style="color:#e6db74">&#34;&#34;&#34;Reply message.&#34;&#34;&#34;</span>
    text <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text
    <span style="color:#66d9ef">if</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/start&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/help&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/about&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/suwen&#34;</span>):
        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;對不起，徐長卿君🤖不能理解你說啥。🤔</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭的聯繫方式，請輸入 /about&#34;</span>)
</code></pre></div><p>若一切正確，測試時亂打一通，就會顯示以下結果：</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-17.38.13-1024x361.png" alt=""></p>
<h4 id="寫ing---error_handler--error">【寫ing - error_handler &amp; error】</h4>
<p>error_handler和error的部分，最大的目的是防止不可預知的down機情形。算是有點類似有黑盒子的汽車開在懸崖峭壁失控，只能拖著懸崖靠摩擦力減速，過程有可能導致chatbot down機也有可能不會，但至少讓user知道chatbot有點問題，也給開發者留下尾巴知道發生啥事。一般來說，經過粗魯測試後沒被玩壞或儲存地方沒啥意外的話理論上不會出現啥問題，但以防萬一，還是先做好準備。</p>
<p>error_handler()的部分很簡單，就是有error時有個feedback給user。在function的括號要加入bot和error，才會知道是針對error而設。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">error_handler</span>(bot, update, error, context: CallbackContext):
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;對不起，徐長卿君🤖不能理解你說啥。🤔</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭的聯繫方式，請輸入 /about&#34;</span>)
</code></pre></div><p>error()部分，就是在console顯示log而已。這部分針對尤其是早期掛本機時公開測試時，若中間有啥error時可以滾回去log看error是啥。若是已經deploy在雲端的話作用不大。當然可以修改下面的code另外儲存log，那就可以隨時可以翻看。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">error</span>(update, context):
    <span style="color:#e6db74">&#34;&#34;&#34;紀錄Updates時出現的errors。出現error時console就會print出下面logger.warning的內容&#34;&#34;&#34;</span>
    logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;Update &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34; caused error &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;&#39;</span>, update, context<span style="color:#f92672">.</span>error)
</code></pre></div><h4 id="整個chatbot的code">【整個chatbot的code】</h4>
<p>整個chatbot寫完後，程式碼如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> os.path
<span style="color:#f92672">import</span> logging
<span style="color:#f92672">import</span> telegram
<span style="color:#f92672">from</span> telegram.ext <span style="color:#f92672">import</span> Updater, CommandHandler, CallbackQueryHandler, MessageHandler, Filters, CallbackContext, ConversationHandler
<span style="color:#f92672">from</span> telegram <span style="color:#f92672">import</span> InlineKeyboardMarkup, InlineKeyboardButton

<span style="color:#75715e"># 允許 logging。當出現error時能知道哪裡出了問題。</span>
logging<span style="color:#f92672">.</span>basicConfig(format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(name)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>,
                    level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)

logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)

<span style="color:#75715e"># 創造Updater，將token pass給Updater。</span>
<span style="color:#75715e"># 在v12中要加入“use_context = True”（之後版本不需要），用於有新訊息是回應。</span>
<span style="color:#75715e"># TOKEN、bot和updater要放在def外面。若只放在main()會出現錯誤</span>
TOKEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;paste-your-token-here&#34;</span>
bot <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>Bot(token <span style="color:#f92672">=</span> TOKEN)
updater <span style="color:#f92672">=</span> Updater(TOKEN, use_context <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_handler</span>(update, context: CallbackContext):

    <span style="color:#75715e"># chatbot在接受用戶輸入/start後的output內容</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING) <span style="color:#75715e"># 會顯示chatbot正在輸入中，增加對話真實感</span>
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>) <span style="color:#75715e"># 在顯示輸入中後停頓1秒，然後顯示下一句code的文字</span>
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;Hello! 你好👋，</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">！我是徐長卿君🤖&#34;</span><span style="color:#f92672">.</span>format(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>from_user<span style="color:#f92672">.</span>first_name)) <span style="color:#75715e"># 給user的output</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;徐長卿君🤖️是個chatbot，能根據關鍵字搜尋《黃帝內經素問》的內容</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">❓關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭，請輸入 /about&#34;</span>) <span style="color:#75715e"># 給user的output。output可以分開多次使用update.message.reply_text()。</span>
    
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">help_handler</span>(update, context: CallbackContext):

    <span style="color:#75715e"># chatbot在接受用戶輸入/start後的output內容</span>
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;《🔍如何使用》</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">搜尋《黃帝內經素問》（中文版）🔸</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">輸入：「/suwen （搜尋關鍵字）」</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">例如：/suwen 伏梁、/suwen 肺脈</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭，請輸入 /about&#34;</span>) 
    
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">about_handler</span>(update, context: CallbackContext):

    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;感謝使用徐長卿君🤖️。徐長卿君🤖️是一個教學用的中醫搜尋chatbot，除了作為中醫古籍搜尋，另外最大目的是讓想要利用python-telegram-bot的新手有個最新的tutorial可供參考。主人曾經跟我說，在做上一個 - 也是第一個Telegram的chatbot算盤子君🤖️（一個台灣大學資訊的chatbot，有興趣可以去@glochidion_bot找算盤子君🤖️）經歷不太愉快。一方面是documentation和tutorial對於新手蠻unfriendly，而且不少已經開始有點過期，同時也沒有太多關於deploy的文章；另一方面有一次因為想要整理output的code一直不成功去求救卻被說是伸手黨，感覺自己努力過卻被當作白痴，太把自己的知識當作理所當然。氣不過，決定根據自己的專業建立一個中醫古籍搜尋器的Telegram chatbot，也藉此寫一篇tutorial，從建立到測試、測試到deploy，讓新手有個可以參考整個過程、實際應用的demo，同時也讓中醫人有多一個工具。&#34;</span>) 
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;徐長卿君🤖️儲存的資料很多，所有資料都是主人親手校對整理，出錯在所難免，因此若想要報錯，又或者有任何疑問、建議，或者想透過徐長卿君🤖️宣傳、洽談合作，可以去扶疏堂研究所的Facebook page私訊聯繫，或者歡迎瀏覽扶疏堂研究所的網站看看其他項目和服務。&#34;</span>)
    
    reply_markup <span style="color:#f92672">=</span> InlineKeyboardMarkup([[
        InlineKeyboardButton(<span style="color:#e6db74">&#34;Facebook&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.facebook.com/herboratory/ &#34;</span>),
        InlineKeyboardButton(<span style="color:#e6db74">&#34;Website&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://herboratory.ai/&#34;</span>)],
        [InlineKeyboardButton(<span style="color:#e6db74">&#34;關於徐長卿君🤖️ About Cynanchum kun🤖️&#34;</span>, callback_data<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;about_me&#34;</span>)]])

    bot<span style="color:#f92672">.</span>send_message(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>id, <span style="color:#e6db74">&#34;想了解什麼？若要報錯或反饋，歡迎透過Facebook或網站與扶疏堂研究所聯繫。&#34;</span>, reply_to_message_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>message_id,
                     reply_markup <span style="color:#f92672">=</span> reply_markup)
    <span style="color:#75715e"># chatbot在接受用戶輸入/start後的output內容</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suwen_handler</span>(update, context: CallbackContext):
    <span style="color:#66d9ef">if</span> len(update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">7</span>:  <span style="color:#75715e"># 如果單純輸入 /suwen 會跟你說叫你該如何輸入，以及因為/suwen 的字元數量一定會小於7</span>
        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;你輸入方式有錯誤。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">請輸入：/suwen 搜尋關鍵字 </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74"> 例如: /suwen 伏梁&#34;</span>)
    <span style="color:#66d9ef">else</span>:
        keyword <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text[<span style="color:#ae81ff">7</span>:] <span style="color:#75715e"># 取得到 /location 後面的參數值</span>
        <span style="color:#66d9ef">if</span> type(keyword) <span style="color:#f92672">==</span> str:
            <span style="color:#75715e"># 搜尋keywords資料</span>
            <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;data/suwen.json&#34;</span>) <span style="color:#66d9ef">as</span> json_file: <span style="color:#75715e"># 打開suwen.json</span>
                data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(json_file)

            search_result <span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">for</span> items <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;items&#34;</span>]:
                article <span style="color:#f92672">=</span> items[<span style="color:#e6db74">&#39;article&#39;</span>]
                <span style="color:#66d9ef">for</span> quotes <span style="color:#f92672">in</span> items[<span style="color:#e6db74">&#34;content&#34;</span>]:
                    <span style="color:#66d9ef">if</span> keyword <span style="color:#f92672">in</span> quotes:
                        search_result<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#34;原句&#34;</span>: quotes, <span style="color:#e6db74">&#34;出處&#34;</span>: article})

            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> search_result:
                bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
                update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;查無結果。🤔😐😔&#34;</span>)

            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;搜尋結果：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">for</span> i, quote_data <span style="color:#f92672">in</span> enumerate(search_result):
                    <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> quote_data:
                        text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">：</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, quote_data[key])
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">------&#34;</span>
                    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">or</span> i <span style="color:#f92672">==</span> len(search_result) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
                        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
                        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
                        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(text)
                        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;搜尋結果（續）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>

        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># 輸入錯誤格式或有誤時，請重新輸入</span>
            update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;你輸入方式有錯誤。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">請輸入：/suwen 搜尋關鍵字 </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74"> 例如: /suwen 伏梁&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getClickButtonData</span>(update, context):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    透過上方的about function取得了callback_data=&#34;about_me&#34;，針對取得的參數值去判斷說要回覆給使用者什麼訊息
</span><span style="color:#e6db74">    取得到對應的callback_data後，去判斷說是否有符合，有符合就執行 update.callback_query.edit_message_text
</span><span style="color:#e6db74">    傳送你想傳送的訊息給使用者
</span><span style="color:#e6db74">    由於這裡不再是單純發訊息，而是再用callback_query的方法，發訊息時，chat_id = update.message.chat_id是不能用，要改成chat_id = update.callback_query.message.chat_id
</span><span style="color:#e6db74">    而
</span><span style="color:#e6db74">    而偽裝輸入正在輸入中也要改成chat_id = update.callback_query.message.chat_id
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">if</span> update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>data <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;about_me&#34;</span>:
        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        update<span style="color:#f92672">.</span>callback_query<span style="color:#f92672">.</span>edit_message_text(<span style="color:#e6db74">&#34;感謝使用徐長卿君🤖️。徐長卿君🤖️是一個教學用的中醫搜尋chatbot，除了作為中醫古籍搜尋，另外最大目的是讓想要利用python-telegram-bot的新手有個最新的tutorial可供參考。主人曾經跟我說，在做上一個 - 也是第一個Telegram的chatbot算盤子君🤖️（一個台灣大學資訊的chatbot，有興趣可以去@glochidion_bot找算盤子君🤖️）經歷不太愉快。一方面是documentation和tutorial對於新手蠻unfriendly，而且不少已經開始有點過期，同時也沒有太多關於deploy的文章；另一方面有一次因為想要整理output的code一直不成功去求救卻被說是伸手黨，感覺自己努力過卻被當作白痴，太把自己的知識當作理所當然。氣不過，決定根據自己的專業建立一個中醫古籍搜尋器的Telegram chatbot，也藉此寫一篇tutorial，從建立到測試、測試到deploy，讓新手有個可以參考整個過程、實際應用的demo，同時也讓中醫人有多一個工具。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">徐長卿君🤖️儲存的資料很多，所有資料都是主人親手校對整理，出錯在所難免，因此若想要報錯，又或者有任何疑問、建議，或者想透過徐長卿君🤖️宣傳、洽談合作，可以去扶疏堂研究所的Facebook page私訊聯繫，或者歡迎瀏覽扶疏堂研究所的網站看看其他項目和服務。&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reply_handler</span>(update, context: CallbackContext):
    <span style="color:#e6db74">&#34;&#34;&#34;Reply message.&#34;&#34;&#34;</span>
    text <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>text
    <span style="color:#66d9ef">if</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/start&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/help&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/about&#34;</span>) <span style="color:#f92672">or</span> (text <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;/suwen&#34;</span>):
        bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;對不起，徐長卿君🤖不能理解你說啥。🤔</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭的聯繫方式，請輸入 /about&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">error_handler</span>(bot, update, error, context: CallbackContext):
    bot<span style="color:#f92672">.</span>send_chat_action(chat_id <span style="color:#f92672">=</span> update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>chat_id, action <span style="color:#f92672">=</span> telegram<span style="color:#f92672">.</span>ChatAction<span style="color:#f92672">.</span>TYPING)
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
    update<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>reply_text(<span style="color:#e6db74">&#34;對不起，徐長卿君🤖不能理解你說啥。🤔</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">關於指令使用方法，請輸入 /help </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">💬關於徐長卿君🤖️，或想要報錯和反饋💭的聯繫方式，請輸入 /about&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">error</span>(update, context):
    <span style="color:#e6db74">&#34;&#34;&#34;紀錄Updates時出現的errors。出現error時console就會print出下面logger.warning的內容&#34;&#34;&#34;</span>
    logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#39;Update &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34; caused error &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;&#39;</span>, update, context<span style="color:#f92672">.</span>error)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;啟動bot&#34;&#34;&#34;</span>
    <span style="color:#75715e"># 設定使用dispatcher，用來以後設定command和回覆用</span>
    dp <span style="color:#f92672">=</span> updater<span style="color:#f92672">.</span>dispatcher
    dp<span style="color:#f92672">.</span>add_handler(CommandHandler(<span style="color:#e6db74">&#34;start&#34;</span>, start_handler)) <span style="color:#75715e"># 啟動chatbot</span>
    dp<span style="color:#f92672">.</span>add_handler(CommandHandler(<span style="color:#e6db74">&#34;help&#34;</span>, help_handler)) <span style="color:#75715e"># 顯示幫助的command</span>
    dp<span style="color:#f92672">.</span>add_handler(CommandHandler(<span style="color:#e6db74">&#34;about&#34;</span>, about_handler)) <span style="color:#75715e"># 顯示關於徐長卿君🤖️的command</span>
    dp<span style="color:#f92672">.</span>add_handler(CommandHandler(<span style="color:#e6db74">&#34;suwen&#34;</span>, suwen_handler)) <span style="color:#75715e"># 《素問》中文版搜尋功能</span>
    dp<span style="color:#f92672">.</span>add_handler(CallbackQueryHandler(getClickButtonData)) <span style="color:#75715e"># 設定關於徐長卿君🤖️的按鈕連結</span>
    dp<span style="color:#f92672">.</span>add_handler(MessageHandler(Filters<span style="color:#f92672">.</span>text, reply_handler)) <span style="color:#75715e"># 設定若非設定command會回覆用戶不知道說啥的訊息</span>
    dp<span style="color:#f92672">.</span>add_error_handler(error_handler) <span style="color:#75715e"># 出現任何非以上能預設的error時會回覆用戶的訊息內容</span>

    <span style="color:#75715e"># 專門紀錄所有errors的handler，對應def error()</span>
    dp<span style="color:#f92672">.</span>add_error_handler(error)

    <span style="color:#75715e"># 啟動Bot。bot程式與Telegram連結有兩種方式：polling和webhook。</span>
    <span style="color:#75715e"># 兩者的差異可以參考這篇reddit的解釋：https://www.reddit.com/r/TelegramBots/comments/525s40/q_polling_vs_webhook/。</span>
    <span style="color:#75715e"># 在python-telegram-bot裡面本身有built-in的webhook方法，但是在GCE中暫時還沒摸索到如何設定webhook，因此polling是最便捷的方法。</span>
    updater<span style="color:#f92672">.</span>start_polling()

    <span style="color:#75715e"># 就是讓程式一直跑。</span>
    <span style="color:#75715e"># 按照package的說法“start_polling() is non-blocking and will stop the bot gracefully.”。</span>
    <span style="color:#75715e"># 若要停止按Ctrl-C 就好</span>
    updater<span style="color:#f92672">.</span>idle()

<span style="color:#75715e">#運行main()，就會啟動bot。</span>
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    main()
</code></pre></div><h3 id="gcp上deploy">【GCP上☁️deploy】</h3>
<p>到這裡，估計chatbot應該是本機運行過、本機也粗魯玩過。要上雲端，若沒有附件（例如不會如這個chatbot需要連帶個JSON檔案的話）或者把附件安置好在某個☁️地方，或者本身連database連結去用的話，可以用Google Function。這裡會用一個「切菜焉用牛刀」的方法，就是在Google Cloud Platform（GCP）開一個虛擬機器（virtual machine），然後把folder的東西整齊放到虛擬機器運行就行。</p>
<p>這裡假設已經有GCP帳戶。沒有的話，先弄個GCP的帳戶，新用戶可以有12個月或300鎂額度，詳細可看<a href="https://cloud.google.com/free/docs/gcp-free-tier?hl=zh-TW">這裡</a>介紹。有GCP帳戶後，登陸到GCP，然後開個新project。輸入project name，然後按CREATE。然後等GCP運作一下，把東西搭建好。就去開虛擬機器。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-18.20.29-1024x666.png" alt=""></p>
<p>然後進入project，按下左上角三條線，就會出現menu如下。在Compute Machine選VM instances。等一切setting完成後，</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-18.28.24-646x1024.png" alt=""></p>
<p>等settle down後，在VM instances按Create。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-18.32.29-1024x539.png" alt=""></p>
<p>進去後，會設定虛擬機器的配備。在這裡可以幫機器命名。Region的話一般選擇asia-east1 (Taiwan)，Zone選擇asia-east1-b。現在用香港的話還是謝謝不送了。不過之前無論是在GCP setup網站還是安置算盤子君🤖️，都是選Taiwan。Machine configuration的話，由於不期望流量很大，所以Series選第一代的N1就好，machine type就選個就算有點流量也沒啥大問題的g1-small (1 vPCU, 1.7 GB memory)。若只是玩玩而已，可以選更小的mirco。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-19.57.55-868x1024.png" alt=""></p>
<p>Boot disk的話改成Debian 10，Identity and API access不需要更動。Firewall勾選Allow HTTP traffic和Allow HTTPS traffic。然後按Create。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-19.59.44-773x1024.png" alt=""></p>
<p>等機器設定好之後，就會進入以下畫面。機器會配備個Internal IP和External IP（這裡我遮蔽了）。接下來就是利用SSH把該upload的東西給upload上去。</p>
<p>在Connect下面有個SSH，按下隔壁的箭頭，會有幾個選項，就選第一個「Open in browser window」。之後會有個popup window跳出來，沒有的話看看browser有沒有阻擋popup設定。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-18.42.03-1024x540.png" alt=""></p>
<p>進去之後，首先建立個folder，我就命名cynanchum_bot，這個folder之後就是儲存chatbot的地方。command如下：</p>
<pre><code>mkdir cynanchum_bot
</code></pre><p>然後進入folder：</p>
<pre><code>cd cynanchum_bot
</code></pre><p>先更新虛擬機器的東西：</p>
<pre><code>apt-get update
</code></pre><p>檢查一下Python版本：</p>
<pre><code>python --version
</code></pre><p>若Python版本不是3+，或顯示“-bash: python: command not found”，就先看看有沒有內置Python 3:</p>
<pre><code>ls /usr/bin/python*
</code></pre><p>沒有的話，就根據以下command安裝Python3。有的話這步就skip。</p>
<pre><code>sudo apt install python3 python3-dev python3-venv
</code></pre><p>然後更改Python版本到3.x（這裡我用3）：</p>
<pre><code>alias python='/usr/bin/python3'
</code></pre><p>然後刷一下.bashrc檔：</p>
<pre><code>. ~/.bashrc
</code></pre><p>然後再檢查Python版本，應該會改成3.5（或自行設定的版本）</p>
<pre><code>python --version
</code></pre><p>版本改好之後，或者本身有Python3，先安裝python3-venv：</p>
<pre><code>sudo apt-get install python3-venv
</code></pre><p>然後就可以建立Python的虛擬環境。由於本來已經在要放置徐長卿君🤖的cynanchum_bot.py和資料的資料夾，所以就直接現成設虛擬環境的名稱就好。這裡名稱為environment：</p>
<pre><code>python3 -m venv environment
</code></pre><p>輸入“ls”，就會看到裡面有個environment的folder。</p>
<p>接下來就是把上傳的東西上傳。我懶得設啥，東西也不多，就每個拉上去就算了。在右上角會看到一個⚙️ icon，按下去，就會有個menu。選Upload file。就可以把檔案upload上去。</p>
<p><img src="https://herboratory.github.io/engineering-department/images/Screenshot-2020-07-25-at-19.11.12.png" alt=""></p>
<p>然後輸入“cd”按Enter，輸入”ls”確定cynanchum_bot.py成功upload。然後利用以下command把主程式搬到folder裡：</p>
<pre><code>mv cynanchum_bot.py cynanchun_bot
</code></pre><p>這裡要說一件滿無聊兼白痴的事，用Upload file，是會把檔案上傳到最頂端的位置，因此要搬運的話可以輸入&quot;cd&quot;然後按Enter，然後輸入以下command把搜尋用的JSON檔搬去data的folder裡（由於正式版本的徐長卿君機器人除了素問資料，還有其他的資料；而除了cynanchum_bot.py之外都是JSON檔，所以可以用這個方案）：</p>
<pre><code>mv *.json ~/cynanchum_bot/data
</code></pre><p>然後就可以利用“cd”回去最上層，然後“cd cynanchum_bot”去儲存的folder位置，進入虛擬環境跑chatbot：</p>
<pre><code>source environment/bin/activate
</code></pre><p>進去虛擬環境後，別太興奮直接跑程式，因為還要安裝python-telegram-bot到GCP的虛擬機器：</p>
<pre><code>pip3 install wheel python-telegram-bot
</code></pre><p>安裝完，就可以試跑了：</p>
<pre><code>python3 cynanchum_bot.py
</code></pre><p>成功的話，就跟之前本機測試一樣，在Telegram輸入東西後，chatbot會有回應。可是若把SSH關掉，程式就會停止運作。所以若要讓程式即使在SSH關掉後，依然能在背景繼續運作，就需要輸入以下command：</p>
<pre><code>nohup python cynanchum_bot.py &amp;
</code></pre><p>然後就能在關掉SSH連線後還能在背景繼續運作。</p>
<h3 id="後記">【後記】</h3>
<p>花了快十二小時，終於寫完這個tutorial。希望這篇tutorial能幫助想要寫chatbot的非相關專業背景同好有個比較全面的起始點。作為chatbot平台，Telegram的免費的確是個賣點，而且從資安角度整體算是暫時相對比較安全（當然要追求安全，要不就用Signal，要不完全不用）。Telegram除了作為IM和建立chatbot的平台，還能建立群組、channel等，功能上也蠻多樣化。</p>
<p>能完成算盤子君🤖️和徐長卿君🤖️，很感謝在Stackoverflow和Python Taiwan的幫助過我的大神，也很感謝中間協助過我的朋友們。</p>
<p>這個tutorial完成，我也放下心頭大石，暫時不會亂手滑寫程式。</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://herboratory.github.io/engineering-department/zh-hk/tags/telegram/">telegram</a></span>
        <span class="tag"><a href="https://herboratory.github.io/engineering-department/zh-hk/tags/chatbot/">chatbot</a></span>
        <span class="tag"><a href="https://herboratory.github.io/engineering-department/zh-hk/tags/python-telegram-bot/">python-telegram-bot</a></span>
        
    </p>

      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://herboratory.github.io/engineering-department/zh-hk/categories/python/">python</a></span>
        <span class="tag"><a href="https://herboratory.github.io/engineering-department/zh-hk/categories/tutorial/">tutorial</a></span>
        
    </p>


      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1297字
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2020-07-25 08:00
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;caption=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;canonicalUrl=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;body=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f&amp;media=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f;description=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f&amp;title=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;summary=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;source=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f&amp;resubmit=true&amp;title=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f;title=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot%20https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f&amp;t=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=%e5%a6%82%e4%bd%95%e5%9c%a8Telegram%e5%88%a9%e7%94%a8python-telegram-bot%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e4%b8%ad%e9%86%ab%e7%b6%93%e5%85%b8%e5%8f%a4%e7%b1%8d%e3%80%8a%e7%b4%a0%e5%95%8f%e3%80%8b%e6%90%9c%e5%b0%8bchatbot&amp;url=https%3a%2f%2fherboratory.github.io%2fengineering-department%2fzh-hk%2fposts%2f2020%2f07%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8telegram%25E5%2588%25A9%25E7%2594%25A8python-telegram-bot%25E5%25BB%25BA%25E7%25AB%258B%25E4%25B8%2580%25E5%2580%258B%25E4%25B8%25AD%25E9%2586%25AB%25E7%25B6%2593%25E5%2585%25B8%25E5%258F%25A4%25E7%25B1%258D%25E7%25B4%25A0%25E5%2595%258F%25E6%2590%259C%25E5%25B0%258Bchatbot%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://herboratory.github.io/engineering-department/zh-hk/posts/2021/06/rasa%E6%90%97%E9%BC%93%E7%AD%86%E8%A8%98-%E5%AE%89%E8%A3%9D/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Rasa搗鼓筆記 - 安裝</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://herboratory.github.io/engineering-department/zh-hk/posts/2020/07/%E5%BE%90%E9%95%B7%E5%8D%BF%E5%90%9B%EF%B8%8Fchatbot-%E7%99%BC%E5%B8%83/">
                    <span class="button__text">徐長卿君🤖️Chatbot 發布</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://herboratory.github.io/engineering-department">工程部｜Engineering Department</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://herboratory.github.io/engineering-department/zh-hk/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/herboratory">扶疏堂研究所｜Herboratory</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://herboratory.github.io/engineering-department/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js" integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>



    </body>
</html>
